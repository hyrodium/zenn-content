---
title: "ç´™ã‚’ç·¨ã‚“ã§æ›²é¢ã‚’ä½œã‚ã†ï¼ã€œElasticSurfaceEmbedding.jlã®ç´¹ä»‹ã€œ"
emoji: "ğŸ³ï¸â€ğŸŒˆ"
type: "tech"
topics:
  - "julia"
  - "math"
published: false
---

# ã¯ã˜ã‚ã«
å…ˆæœˆã€[ã¯ã˜ã‚ã¦ã®è«–æ–‡](https://arxiv.org/abs/2211.06372)ã‚’arXivã§å…¬é–‹ã—ã¾ã—ãŸï¼
ç´™ã‚’ç·¨ã‚“ã§æ›²é¢ã‚’ã¤ãã‚‹ç ”ç©¶ã§ã€ç†è«–çš„ãªè§£èª¬ã¯[é€£ãƒ„ã‚¤](https://twitter.com/Hyrodium/status/1592133224876363776)ã«ã‚ã‚Šã¾ã™ã€‚

![](https://github.com/hyrodium/ElasticSurfaceEmbedding.jl/raw/main/docs/src/img/CatenoidHelicoid.gif)
![](https://storage.googleapis.com/zenn-user-upload/1689f7637276-20221129.png)

æœ¬è¨˜äº‹ã§ã¯ã“ã®ç†è«–ã‚’Juliaã§å®Ÿè£…ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è§£èª¬ã‚’ã—ã¾ã™ï¼

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•
Juliaã®pkgãƒ¢ãƒ¼ãƒ‰ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
```
(@v1.8) pkg> add BasicBSpline StaticArrays IntervalSets
(@v1.8) pkg> add https://github.com/hyrodium/BasicBSplineExporter.jl
(@v1.8) pkg> add https://github.com/hyrodium/ElasticSurfaceEmbedding.jl
```

# æœ€åˆã®å®Ÿè¡Œä¾‹
https://twitter.com/Hyrodium/status/1067772101333929987

ã“ã®æ›²é¢ã‚’ç·¨ã‚€ãŸã‚ã®å½¢çŠ¶ã‚’è¨ˆç®—ã™ã‚‹ã«ã¯ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
```julia
using IntervalSets
using BasicBSpline
using StaticArrays
using ElasticSurfaceEmbedding
ElasticSurfaceEmbedding.ğ’‘â‚â‚€â‚(uÂ¹,uÂ²) = SVector(uÂ¹, uÂ², uÂ¹^2+uÂ²^2)
n = 10
D(i,n) = (-1.0..1.0, (i-1)/n..i/n)
allsteps = ElasticSurfaceEmbedding.AllSteps()
for i in 1:10
    initial_state!(allsteps, D(i,n), nâ‚=25)
    newton_onestep!(allsteps, fixingmethod=:fix3points)
    newton_onestep!(allsteps)
    refinement!(allsteps, pâ‚Š=(0,1), kâ‚Š=(EmptyKnotVector(),KnotVector([(i-1/2)/10])))
    newton_onestep!(allsteps)
    newton_onestep!(allsteps)
    pin(allsteps)
end
```
å‡¦ç†å†…å®¹ã®è§£èª¬ã¯å¾Œè¿°ã™ã‚‹ã¨ã—ã¦ã€å®Ÿè¡Œçµæœã¯`allsteps`ã®å‡ºåŠ›ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚
:::details `allsteps`ã®å‡ºåŠ›
```julia
julia> allsteps
1: Initial state - domain: [-1.0, 1.0]Ã—[0.0, 0.1]
â””â”€2: Newton onestep - residual norm: 3.0098e-02, Î”a norm: 1.9847e-02, computation time: 22ms
  â””â”€3: Newton onestep - residual norm: 1.8804e-03, Î”a norm: 1.3264e-02, computation time: 22ms
    â””â”€4: Refinement - pâ‚Š:(0, 1), kâ‚Š:(Bool[], [0.05])
      â””â”€5: Newton onestep - residual norm: 1.8434e-03, Î”a norm: 4.3219e-03, computation time: 77ms
        â””â”€6: ğŸ“Œ Newton onestep - residual norm: 2.7186e-06, Î”a norm: 1.3806e-04, computation time: 99ms
7: Initial state - domain: [-1.0, 1.0]Ã—[0.1, 0.2]
â””â”€8: Newton onestep - residual norm: 3.3025e-02, Î”a norm: 2.3630e-02, computation time: 31ms
  â””â”€9: Newton onestep - residual norm: 1.9982e-03, Î”a norm: 1.4734e-02, computation time: 25ms
    â””â”€10: Refinement - pâ‚Š:(0, 1), kâ‚Š:(Bool[], [0.15])
      â””â”€11: Newton onestep - residual norm: 1.6288e-03, Î”a norm: 1.0403e-02, computation time: 81ms
        â””â”€12: ğŸ“Œ Newton onestep - residual norm: 3.9412e-06, Î”a norm: 3.1503e-04, computation time: 82ms
13: Initial state - domain: [-1.0, 1.0]Ã—[0.2, 0.3]
â””â”€14: Newton onestep - residual norm: 3.6870e-02, Î”a norm: 2.6618e-02, computation time: 24ms
  â””â”€15: Newton onestep - residual norm: 2.1813e-03, Î”a norm: 1.3912e-02, computation time: 24ms
    â””â”€16: Refinement - pâ‚Š:(0, 1), kâ‚Š:(Bool[], [0.25])
      â””â”€17: Newton onestep - residual norm: 1.3023e-03, Î”a norm: 1.2485e-02, computation time: 83ms
        â””â”€18: ğŸ“Œ Newton onestep - residual norm: 4.4132e-06, Î”a norm: 3.3974e-04, computation time: 82ms
19: Initial state - domain: [-1.0, 1.0]Ã—[0.3, 0.4]
â””â”€20: Newton onestep - residual norm: 4.0001e-02, Î”a norm: 2.8676e-02, computation time: 24ms
  â””â”€21: Newton onestep - residual norm: 2.3386e-03, Î”a norm: 1.2158e-02, computation time: 23ms
    â””â”€22: Refinement - pâ‚Š:(0, 1), kâ‚Š:(Bool[], [0.35])
      â””â”€23: Newton onestep - residual norm: 9.7245e-04, Î”a norm: 1.2222e-02, computation time: 83ms
        â””â”€24: ğŸ“Œ Newton onestep - residual norm: 3.9234e-06, Î”a norm: 2.7297e-04, computation time: 83ms
25: Initial state - domain: [-1.0, 1.0]Ã—[0.4, 0.5]
â””â”€26: Newton onestep - residual norm: 4.1891e-02, Î”a norm: 3.0282e-02, computation time: 23ms
  â””â”€27: Newton onestep - residual norm: 2.4125e-03, Î”a norm: 1.0475e-02, computation time: 23ms
    â””â”€28: Refinement - pâ‚Š:(0, 1), kâ‚Š:(Bool[], [0.45])
      â””â”€29: Newton onestep - residual norm: 6.9762e-04, Î”a norm: 1.0958e-02, computation time: 83ms
        â””â”€30: ğŸ“Œ Newton onestep - residual norm: 3.1803e-06, Î”a norm: 1.8120e-04, computation time: 82ms
31: Initial state - domain: [-1.0, 1.0]Ã—[0.5, 0.6]
â””â”€32: Newton onestep - residual norm: 4.2636e-02, Î”a norm: 3.1610e-02, computation time: 24ms
  â””â”€33: Newton onestep - residual norm: 2.4006e-03, Î”a norm: 9.0638e-03, computation time: 23ms
    â””â”€34: Refinement - pâ‚Š:(0, 1), kâ‚Š:(Bool[], [0.55])
      â””â”€35: Newton onestep - residual norm: 4.9253e-04, Î”a norm: 9.3891e-03, computation time: 81ms
        â””â”€36: ğŸ“Œ Newton onestep - residual norm: 2.4826e-06, Î”a norm: 1.0638e-04, computation time: 82ms
37: Initial state - domain: [-1.0, 1.0]Ã—[0.6, 0.7]
â””â”€38: Newton onestep - residual norm: 4.2520e-02, Î”a norm: 3.2710e-02, computation time: 23ms
  â””â”€39: Newton onestep - residual norm: 2.3252e-03, Î”a norm: 7.9393e-03, computation time: 23ms
    â””â”€40: Refinement - pâ‚Š:(0, 1), kâ‚Š:(Bool[], [0.65])
      â””â”€41: Newton onestep - residual norm: 3.5192e-04, Î”a norm: 7.8423e-03, computation time: 85ms
        â””â”€42: ğŸ“Œ Newton onestep - residual norm: 1.8940e-06, Î”a norm: 5.9199e-05, computation time: 83ms
43: Initial state - domain: [-1.0, 1.0]Ã—[0.7, 0.8]
â””â”€44: Newton onestep - residual norm: 4.1818e-02, Î”a norm: 3.3595e-02, computation time: 24ms
  â””â”€45: Newton onestep - residual norm: 2.2113e-03, Î”a norm: 7.0824e-03, computation time: 24ms
    â””â”€46: Refinement - pâ‚Š:(0, 1), kâ‚Š:(Bool[], [0.75])
      â””â”€47: Newton onestep - residual norm: 2.6462e-04, Î”a norm: 6.4460e-03, computation time: 84ms
        â””â”€48: ğŸ“Œ Newton onestep - residual norm: 1.4061e-06, Î”a norm: 3.3403e-05, computation time: 87ms
49: Initial state - domain: [-1.0, 1.0]Ã—[0.8, 0.9]
â””â”€50: Newton onestep - residual norm: 4.0747e-02, Î”a norm: 3.4278e-02, computation time: 23ms
  â””â”€51: Newton onestep - residual norm: 2.0776e-03, Î”a norm: 6.4475e-03, computation time: 23ms
    â””â”€52: Refinement - pâ‚Š:(0, 1), kâ‚Š:(Bool[], [0.85])
      â””â”€53: Newton onestep - residual norm: 2.1727e-04, Î”a norm: 5.2313e-03, computation time: 83ms
        â””â”€54: ğŸ“Œ Newton onestep - residual norm: 1.0064e-06, Î”a norm: 1.9814e-05, computation time: 83ms
55: Initial state - domain: [-1.0, 1.0]Ã—[0.9, 1.0]
â””â”€56: Newton onestep - residual norm: 3.9462e-02, Î”a norm: 3.4782e-02, computation time: 24ms
  â””â”€57: Newton onestep - residual norm: 1.9369e-03, Î”a norm: 5.9769e-03, computation time: 23ms
    â””â”€58: Refinement - pâ‚Š:(0, 1), kâ‚Š:(Bool[], [0.95])
      â””â”€59: Newton onestep - residual norm: 1.9491e-04, Î”a norm: 4.1940e-03, computation time: 84ms
        â””â”€60: ğŸ“Œ Newton onestep - residual norm: 6.8995e-07, Î”a norm: 1.2158e-05, computation time: 83ms
```
:::

å®Ÿè¡Œçµæœã‚’SVGç”»åƒã¨ã—ã¦å‡ºåŠ›ã™ã‚‹ã«ã¯ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
```julia
export_pinned_steps(".", allsteps, unitlength=(50, "mm"), mesh=(20,1))
```
ã“ã‚Œã§`./pinned`ä»¥ä¸‹ã«ä»¥ä¸‹ã®ã‚ˆã†ãªSVGç”»åƒãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚
```
.
â””â”€â”€ pinned
 Â Â  â”œâ”€â”€ pinned-6.svg
 Â Â  â”œâ”€â”€ pinned-12.svg
 Â Â  â”œâ”€â”€ pinned-18.svg
 Â Â  â”œâ”€â”€ pinned-24.svg
 Â Â  â”œâ”€â”€ pinned-30.svg
 Â Â  â”œâ”€â”€ pinned-36.svg
 Â Â  â”œâ”€â”€ pinned-42.svg
 Â Â  â”œâ”€â”€ pinned-48.svg
 Â Â  â”œâ”€â”€ pinned-54.svg
 Â Â  â””â”€â”€ pinned-60.svg
```
<ç”»åƒ>

ã“ã®å½¢çŠ¶ã‚’ãƒ¬ãƒ¼ã‚¶ãƒ¼åŠ å·¥æ©Ÿç­‰ã§åˆ‡ã‚Šå‡ºã—ã€ç·¨ã¿ä¸Šã’ã‚Œã°æ”¾ç‰©é¢ãŒã§ãã‚‹ã¨ã„ã†è¨³ã§ã™ï¼

![](https://storage.googleapis.com/zenn-user-upload/ec7bc5d2199f-20221129.png)

# ã‚³ãƒ¼ãƒ‰ã®è§£èª¬
```julia
using IntervalSets
using BasicBSpline
using StaticArrays
using ElasticSurfaceEmbedding
```
ã“ã‚Œã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ã§ã™ã­ã€‚
[BasicBSpline.jl]()ã¯ä»¥å‰ã®è¨˜äº‹ã§ã‚‚ç´¹ä»‹ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã™ãŒã€å…ƒã€…ã¯æœ¬ç ”ç©¶ã®ãŸã‚ã«æ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ãŒãƒ™ãƒ¼ã‚¹ã«ãªã£ã¦ã„ã¾ã™ã€‚
åˆ¥ã®è¨˜äº‹ã§ã‚ã‚‰ãŸã‚ã¦ç´¹ä»‹äºˆå®šã§ã™ã€‚

```julia
ElasticSurfaceEmbedding.ğ’‘â‚â‚€â‚(uÂ¹,uÂ²) = SVector(uÂ¹, uÂ², uÂ¹^2+uÂ²^2)
```
ã§æ›²é¢ã®å½¢çŠ¶ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

```julia
n = 10
D(i,n) = (-1.0..1.0, (i-1)/n..i/n)
```
ã“ã¡ã‚‰ã¯å®šç¾©åŸŸã®å®šç¾©ã§ã™ã­ã€‚

```julia
allsteps = ElasticSurfaceEmbedding.AllSteps()
```
è¨ˆç®—çµæœã‚’æœ¨æ§‹é€ ã§æŒã¡ã¾ã™ã€‚

```julia
for i in 1:10
    initial_state!(allsteps, D(i,n), nâ‚=25)
    newton_onestep!(allsteps, fixingmethod=:fix3points)
    newton_onestep!(allsteps)
    refinement!(allsteps, pâ‚Š=(0,1), kâ‚Š=(EmptyKnotVector(),KnotVector([(i-1/2)/10])))
    newton_onestep!(allsteps)
    newton_onestep!(allsteps)
    pin(allsteps)
end
```
ã“ã“ãŒãƒ¡ã‚¤ãƒ³ã®å‡¦ç†ã«ãªã‚Šã¾ã™ã€‚

* `i`ã‚’å›ã—ã¦å®šç¾©åŸŸã‚’$[-1,1]\times[0.0,0.1]$ã‹ã‚‰$[-1,1]\times[0.9,1.0]$ã¾ã§è¨ˆç®—ã—ã¦ã„ã‚‹ã€‚
* æ¸¬åœ°çš„æ›²ç‡ã‚’ã‚‚ã¨ã«åˆæœŸå½¢çŠ¶ã‚’æ±ºå®šã™ã‚‹ã€‚(`initial_state!`)
* Newtonæ³•(`newton_onestep!`)ã§è¨ˆç®—ã—ã¦ã„ã‚‹ã®ã§åæŸã¯æ—©ãã€åæŸã®è‡ªå‹•åˆ¤å®šã¯å®Ÿè£…ã—ã¦ã„ãªã„ã€‚
* é€”ä¸­ã§è¨ˆç®—åˆ¶åº¦å‘ä¸Šã®ãŸã‚ã«ãƒªãƒ•ã‚¡ã‚¤ãƒ³ãƒ¡ãƒ³ãƒˆ(`refinement!`)ã®è¨ˆç®—ã‚‚å…¥ã‚Œã¦ã„ã‚‹ã€‚
* SVGå‡ºåŠ›ã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—ã‚’`pin(allsteps)`ã§æŒ‡å®šã—ã¦ã„ã‚‹ã€‚

# å†…éƒ¨å‡¦ç†ã®è§£èª¬


