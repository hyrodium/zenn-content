---
title: "BasicBSpline.jlã‚’ä½œã£ãŸã®ã§å®£ä¼ã§ã™ï¼"
emoji: "ğŸ’¼"
type: "tech"
topics:
  - "julia"
  - "math"
  - "æ•°å€¤è¨ˆç®—"
  - "bã‚¹ãƒ—ãƒ©ã‚¤ãƒ³"
published: true
published_at: "2020-12-21 00:03"
---

# [Julia Advent Calendar 2020](https://qiita.com/advent-calendar/2020/julia)/12/21

:::message alert
**2021/12/28 æ›´æ–°**
æœ¬æ—¥ã€BasicBSpline.jlã®[v0.3.0ã‚’ãƒªãƒªãƒ¼ã‚¹](https://github.com/hyrodium/BasicBSpline.jl/releases/tag/v0.3.0)ã—ã¾ã—ãŸï¼ç ´å£Šçš„å¤‰æ›´ãŒå¹¾ã¤ã‹å…¥ã£ã¦ã„ã‚‹ã®ã§ã€æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯å‹•ã‹ãªã„ã¨æ€ã„ã¾ã™ã€‚æœ¬è¨˜äº‹ã¯è¨˜éŒ²ã®ãŸã‚ã€æ›´æ–°ã›ãšã«æ®‹ã—ã¦ãŠã“ã†ã¨æ€ã„ã¾ã™ã€‚æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã®ä½¿ã„æ–¹ã«ã¤ã„ã¦ã¯[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://hyrodium.github.io/BasicBSpline.jl/dev/)ã‚’å‚ç…§ãã ã•ã„ã€‚æ™‚é–“ãŒã‚ã‚Œã°æ—¥æœ¬èªã§ã®è§£èª¬ã‚’æ›¸ã“ã†ã¨æ€ã„ã¾ã™ãŒã€å°‘ã—å…ˆã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚
:::


# TL;DR
* Juliaã§Bã‚¹ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ‰±ã†ãŸã‚ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ [BasicBSpline.jl](https://juliahub.com/ui/Packages/BasicBSpline/KfsKa)ã‚’ä½œã‚Šã¾ã—ãŸã€‚
* B-splineã¯ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãƒ»CADãƒ»æ•°å€¤è§£æãªã©ã€æ§˜ã€…ãªå¿œç”¨ãŒã‚ã‚Šã¾ã™ã€‚
* æœ¬è¨˜äº‹ã®å¾ŒåŠã§ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä½¿ã„æ–¹ã‚’æ›¸ãã¾ã™ã€‚

â†“â†“ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãŸã‚ã«ä½œã£ãŸãƒ­ã‚´ã§ã™â†“â†“

![](https://storage.googleapis.com/zenn-user-upload/34ke0c27ro6feg87zyoisd4u1t5w)

# B-splineåŸºåº•é–¢æ•°ã®å®šç¾©
[B-splineåŸºåº•é–¢æ•°](https://ja.wikipedia.org/wiki/B-%E3%82%B9%E3%83%97%E3%83%A9%E3%82%A4%E3%83%B3%E6%9B%B2%E7%B7%9A)ã¨ã¯, ä¸ãˆã‚‰ã‚ŒãŸãƒãƒƒãƒˆåˆ—$k=(k_1,\dots,k_l)$ã«å¯¾ã—ã¦ä»¥ä¸‹ã®æ¼¸åŒ–å¼(Cox-de Boorã®å…¬å¼)ã§å®šç¾©ã•ã‚Œã‚‹é–¢æ•°ã®ã“ã¨ã§ã™ã€‚

$$
\begin{aligned}
{B}_{(i,p,k)}(t)
&=
\frac{t-k_{i}}{k_{i+p}-k_{i}}{B}_{(i,p-1,k)}(t)
+\frac{k_{i+p+1}-t}{k_{i+p+1}-k_{i+1}}{B}_{(i+1,p-1,k)}(t) \\
{B}_{(i,0,k)}(t)
&=
\begin{cases}
    &1\quad (k_{i}\le t< k_{i+1})\\
    &0\quad (\text{otherwise})
\end{cases}
\end{aligned}
$$

ãƒãƒƒãƒˆåˆ—ã¨ã„ã†ã®ã¯ã€å®Ÿè»¸ä¸Šã«ãªã‚‰ã‚“ã (åºƒç¾©)å˜èª¿å¢—åŠ æœ‰é™åˆ—ã®ã“ã¨ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/yaklkkfddsolq6fgkdkbif88o7lw)

ä¾‹ãˆã°, $p=0$ã«å¯¾ã—ã¦ã¯ã“ã®ã‚ˆã†ãªçŸ©å½¢ã®ä¸é€£ç¶šé–¢æ•°ã«ãªã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/fglj2rdz7r639cj1wj492s8y0r3w)

$p=1$ã«å¯¾ã—ã¦ã¯ã“ã®ã‚ˆã†ãªæŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã«ãªã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/ji3frlduyogw6hcktjxh5edgyoud)

$p=2$ã ã¨ã“ã‚“ãªæ„Ÿã˜ã€‚

![](https://storage.googleapis.com/zenn-user-upload/p5lda3yu7j9b84ocdde965s8uj0c)

Desmosã§è©¦ã™ã«ã¯ã“ã¡ã‚‰â†“

https://www.desmos.com/calculator/ql6jqgdabs

ä»Šå›ä½œã£ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸BasicBSpline.jlã¯ã“ã‚Œã‚‰ã®é–¢æ•°ã‚’æ‰±ã†ãŸã‚ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ãªã‚Šã¾ã™ã€‚
ãŸã£ãŸã“ã‚Œã ã‘ã€ **ã€Œä¸€ã¤ã®æ¼¸åŒ–å¼(Cox-de Boorã®å…¬å¼)ã‚’æ‰±ã†ã ã‘ã€** ãªã®ã§ã™ãŒã€çµæ§‹å¥¥ãŒæ·±ãã¦8ãƒ¶æœˆãã‚‰ã„ã‹ã‘ã¦ãƒãƒãƒãƒå®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚
ãã—ã¦å…ˆæ—¥ã¤ã„ã«å…¬å¼ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ–¹ã«`v0.1.0`ãŒç™»éŒ²ã•ã‚Œã¾ã—ãŸğŸ‰

ä¸€ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
Juliaã§Cox-de Boorã®å…¬å¼ã‚’ç´ ç›´ã«ãã®ã¾ã¾å®Ÿè£…ã—ã¦ã¿ã‚‹ã¨ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```julia
function B(i,p,k,t)
    if p==0
        return float(k[i]â‰¤t<k[i+1])
    else
        return B(i,p-1,k,t)*(t-k[i])/(k[i+p]-k[i]) + B(i+1,p-1,k,t)*(k[i+p+1]-t)/(k[i+p+1]-k[i+1])
    end
end
```

BasicBSpline.jlã§ã¯ã€ã“ã®é–¢æ•°ãŒã™ã§ã«`bsplinebasis`ã¨ã—ã¦ç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚
ä¸¡è€…ã®è¨ˆç®—æ™‚é–“ã‚’æ¯”è¼ƒã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```julia
using BenchmarkTools

knotvector = sort(rand(10))
p = 3
i = 1
t = 0.2
@benchmark B(i,p,knotvector,t)

k = Knots(knotvector)
P = FastBSplineSpace(p,k)
@benchmark bsplinebasis(P,i,t)
```

ç´ ç›´ãªå®Ÿè£…: **118.757 ns**
BasicBSpline.jl: **46.722 ns**

ãƒ€ãƒ³ãƒã§BasicBSpline.jlã®å‹ã¡ï¼
é€Ÿåº¦é¢ã‚‚ãã†ã§ã™ãŒã€æ©Ÿèƒ½é¢ã§ã‚‚è‰²ã€…ã¨å……å®Ÿã—ã¦ã¾ã™ã€‚

# ãã‚‚ãã‚‚B-splineã£ã¦ä½•ã«ä½¿ã†ã®ï¼Ÿ

## ã¾ãšã¯BÃ©zieræ›²ç·šã‹ã‚‰
[BÃ©zieræ›²ç·š](https://ja.wikipedia.org/wiki/%E3%83%99%E3%82%B8%E3%82%A7%E6%9B%B2%E7%B7%9A)ã‚’ã”å­˜çŸ¥ã®æ–¹ã¯ãŸã¶ã‚“å¤šã„ã¨æ€ã„ã¾ã™ã€‚
Illustratorã‚„Inkscapeãªã©ç­‰ã®ãƒ‰ãƒ­ãƒ¼ç³»ã‚½ãƒ•ãƒˆã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚¢ãƒ¬ã§ã™ã­ã€‚
ã“ã®ã‚ˆã†ãªã‚¤ãƒ©ã‚¹ãƒˆç­‰ã§ã¯ã€è¤‡æ•°ã®BÃ©zieræ›²ç·šã‚’çµ„ã¿åˆã‚ã›ã¦å½¢çŠ¶ãŒæ±ºå®šã•ã‚Œã¦ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/rc5xxoxuzzjz1epq53w777m4ccgd)

BÃ©zieræ›²ç·šã«ã¯æ¬¡ã®ã‚ˆã†ãªæ€§è³ªãŒã‚ã‚Šã¾ã™ã€‚

* æ›²ç·šã®å½¢çŠ¶ã¯åˆ¶å¾¡ç‚¹ã‹ã‚‰æ±ºå®šã•ã‚Œã‚‹
* åˆ¶å¾¡ç‚¹ã‚’å¹³è¡Œç§»å‹•ã™ã‚‹ã¨ã€ãã‚Œã«è¿½å¾“ã—ã¦æ›²ç·šã‚‚å¹³è¡Œç§»å‹•ã™ã‚‹

![](https://storage.googleapis.com/zenn-user-upload/5ppy8gsof5pywac6pekd3zarfzjv)
https://www.desmos.com/calculator/7bdnhdzbxu

ã˜ã¤ã¯ã€ã“ã®BÃ©zieræ›²ç·šã¯$p=3$æ¬¡ã®å¤šé …å¼æ›²ç·šã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

$$
\begin{aligned}
\bm{p}(t) &= \sum_{i=1}^n B_{(i,p)}(t)\bm{a}_i & (n=p+1) \\
B_{(i,p)}(t) &= \binom{p}{i}(1-t)^{p-i-1}t^{i}
\end{aligned}
$$

ã“ã“ã§$B_{(i,p)}$ã¯[Bernsteinå¤šé …å¼](https://ja.wikipedia.org/wiki/%E3%83%90%E3%83%BC%E3%83%B3%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%B3%E5%A4%9A%E9%A0%85%E5%BC%8F)ã¨å‘¼ã°ã‚Œã‚‹ã‚‚ã®ã§ã€$n$ã¯åˆ¶å¾¡ç‚¹ã®æ•°ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/eildxxm2zaeqnzmumigbf7xe8ikm)

https://www.desmos.com/calculator/yc2qe6j6re

ã•ã¦ã€BÃ©zieræ›²ç·šã‚’è¤‡æ•°ç¹‹ã’ãŸã¨ã—ã¦ã€ãã®æ»‘ã‚‰ã‹ã•ã¯ä¸€èˆ¬ã«ã¯**ä¿è¨¼ã•ã‚Œã¾ã›ã‚“**ã€‚
(æ»‘ã‚‰ã‹ã•ã¨ã¯ã€æ•°å­¦çš„ã«ã¯ã€Œã©ã‚Œãã‚‰ã„å¾®åˆ†ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã€ã¨ã„ã†æƒ…å ±ã®ã“ã¨ã§ã™)

æ¥ãƒ™ã‚¯ãƒˆãƒ«ãŒæ»‘ã‚‰ã‹ã«ç¹‹ãŒã‚‰ãªã„ä¾‹â†“

![](https://storage.googleapis.com/zenn-user-upload/0roecsvcvknzgd0cenzv6dzcgc32)

æ›²ç·šã®å¹³é¢æ›²ç‡ãŒä¸é€£ç¶šé–¢æ•°ã«ãªã‚‹ä¾‹â†“

![](https://storage.googleapis.com/zenn-user-upload/0p8xmrvykk8tp5iqvzc4mhtajjz1)

ã§ã¯ã€ã‚ã‚‹ç¨‹åº¦ã®æ»‘ã‚‰ã‹ã•ã‚’ä¿è¨¼ã—ã¦BÃ©zieræ›²ç·šã‚’ç¹‹ã’ã‚‹ã“ã¨ã¯ã§ããªã„ã®ã§ã—ã‚‡ã†ã‹?
ã“ã®å•é¡Œã«å¯¾ã™ã‚‹ä¸€ã¤ã®ç­”ãˆãŒ**B-splineæ›²ç·š**ã§ã™ã€‚
(ã“ã“ã§ã¯$p$æ¬¡å¤šé …å¼ã‚’ç¹‹ã’ã¦åŒºåˆ†å¤šé …å¼ã‚’ä½œã‚‹ã“ã¨ã‚’è€ƒãˆã¦ã„ã¾ã™ã€‚å…¨ä½“ã§ã®$C^p$ç´šã‚’ä»®å®šã™ã‚Œã°åŒºåˆ†åŒ–ã™ã‚‹æ„å‘³ãŒç„¡ã„ã®ã§ã€$C^{p-1}$ç´šä»¥ä¸‹ã®æ»‘ã‚‰ã‹ã•ã‚’è¦æ±‚ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚)

## B-splineæ›²ç·š
ä¸Šè¨˜ã®BÃ©zieræ›²ç·šã§ã®BernsteinåŸºåº•é–¢æ•°$B_{(i,p)}$ã‚’B-splineåŸºåº•é–¢æ•°$B_{(i,p,k)}$ã«å–ã‚Šæ›¿ãˆã¦ã¿ã¾ã—ã‚‡ã†ï¼

$$
\begin{aligned}
\bm{p}(t) &= \sum_{i=1}^n B_{(i,p,k)}(t)\bm{a}_i & (k=(k_1,\dots, k_l), n = l-p-1)
\end{aligned}
$$

ã¯ã„ã€ã“ã‚ŒãŒB-splineæ›²ç·šã§ã™ã€‚
ç­‰é–“éš”ã«ãƒãƒƒãƒˆåˆ—ã‚’å–ã£ã¦ã€$p=2$ã¨ã—ãŸå ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ãªB-splineæ›²ç·šãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/ldxikbrims7o6gp482dx2vbs79fg)

B-splineåŸºåº•é–¢æ•°ã¯åŒºåˆ†å¤šé …å¼ãªã®ã§ã€B-splineæ›²ç·šã¯çµå±€ã€è¤‡æ•°ã®BÃ©zieræ›²ç·šã‚’ã¤ãªã’ãŸã‚‚ã®ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/vn6mhri53dbq3n837o9yabdxkpul)

ã•ã‚‰ã«ã€ãã®ç¹‹ãç›®(ãƒãƒƒãƒˆ)ã§ã‚ã‚‹ç¨‹åº¦æ»‘ã‚‰ã‹ã«ãªã£ã¦ã„ã¾ã™ã€‚ã“ã‚ŒãŒã‹ãªã‚Šå¬‰ã—ã„æ€§è³ªã§ã™ã€‚

ãã®ä¸€ä¾‹ã¨ã—ã¦ã€iPhoneã®å¤–å‘¨ã‚’ç´¹ä»‹ã—ã¾ã—ã‚‡ã†ã€‚
iPhoneã®å¤–å‘¨ã¯ç·šåˆ†ã¨å††å¼§ã§

![](https://storage.googleapis.com/zenn-user-upload/9u773n1om2g8q9kbyasr7h3ium6b)

ã®ã‚ˆã†ã«ã¯ä½œã‚‰ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã€Œå††å¼§ã¨ç·šåˆ†ã€ã ã¨ã¤ãªãç›®ã§æ›²ç‡ãŒä¸é€£ç¶šã«ãªã‚‹ãŸã‚ã€å…‰ã®åå°„ãŒä¸è‡ªç„¶ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚

å®Ÿéš›ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™â†“

![](https://storage.googleapis.com/zenn-user-upload/w6p1krr8slc3ovwgu1co9bfe3eca)

ç”»åƒã¯Accessory Design Guidelines for Apple Devices (Release R13)ã‚ˆã‚Š
https://developer.apple.com/accessories/

ã“ã®ã‚ˆã†ãªè¤‡é›‘ãªå½¢çŠ¶ã¯ã€B-splineã‚’ç”¨ã„ã¦è¨­è¨ˆã•ã‚Œã¦ãŠã‚Šã€ãã®å½¢çŠ¶ã‚’ã‚‚ã¨ã«å›³é¢ã«è½ã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚(ãŸã¶ã‚“)

## BÃ©zieræ›²é¢
BÃ©zieræ›²ç·šã«é–¢é€£ã—ã¦ã€BÃ©zieræ›²é¢ã¨ã„ã†ã‚‚ã®ã‚‚ã‚ã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/8ir7jf0w881qno51vpnaqxu00uvo)

å®šç¾©å¼ã¯

$$
\begin{aligned}
\bm{p}(t_1,t_2) &= \sum_{i=1}^{n_1}\sum_{j=1}^{n_2} B_{(i,p_1)}(t_1)B_{(j,p_2)}(t_2)\bm{a}_{ij} & (n_1=p_1+1, n_2=p_2+1)
\end{aligned}
$$

ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/07s4i9354mt9ym2w6uz688miffvu)

## B-splineæ›²é¢
åŒæ§˜ã«åŸºåº•é–¢æ•°ã‚’**BernsteinåŸºåº•é–¢æ•°**ã‹ã‚‰**B-splineåŸºåº•é–¢æ•°**ã«å–ã‚Šæ›¿ãˆã¾ã—ã‚‡ã†ï¼

$$
\begin{aligned}
\bm{p}(t_1,t_2) &= \sum_{i=1}^{n_1}\sum_{j=1}^{n_2} B_{(i,p_1,k_1)}(t_1)B_{(j,p_2,k_2)}(t_2)\bm{a}_{ij} & (n_1=l_1-p_1-1, n_2=l_2-p_2-1)
\end{aligned}
$$

![](https://storage.googleapis.com/zenn-user-upload/5yndvmb7m00oi4ckzijbd1s2blxz)

æ›²ç·šã®ã¨ãã¨åŒæ§˜ã«ã€B-splineæ›²ç·šã¯BÃ©zieræ›²é¢ã‚’ç¹‹ã’ãŸã‚‚ã®ãªã®ã§ã™ãŒã€ã“ã¡ã‚‰ã®ç”»åƒã‹ã‚‰ã‚‚ã€Œæ»‘ã‚‰ã‹ã€ã«ç¹‹ãŒã£ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚

ã¾ãŸã€åŸ‹ã‚è¾¼ã¿å…ˆã®ç©ºé–“ãŒ2æ¬¡å…ƒã®å ´åˆã§ã‚‚"æ›²é¢"ã¨å‘¼ã¶ã“ã¨ã¨ã—ã¾ã™ã€‚
(å¾Œã®ã‚³ãƒ¼ãƒ‰ä¾‹ã§ã¯ã“ã®æ›²é¢ã‚’ä¾‹ã«ã—ã¾ã™ã€‚)

![](https://storage.googleapis.com/zenn-user-upload/0ekv32rxmw6sx9nn1p38qc4red9l)

## çµå±€ã€B-splineã¨ã¯
* æ•°å­¦çš„ã«ã¯åŒºåˆ†å¤šé …å¼
* BÃ©zieræ›²ç·šã‚’ã€Œæ»‘ã‚‰ã‹ã«ç¹‹ã’ã¦ã€ä¸€èˆ¬åŒ–ã—ãŸã‚‚ã®
* æ›²ç·š(curve)ãƒ»æ›²é¢(surface)ã ã‘ã§ã¯ãªãã€ç«‹ä½“(ä¸­èº«ãŒè©°ã¾ã£ãŸã‚‚ã®, solid)ã‚‚è¡¨ç¾å¯èƒ½
* ãªã®ã§ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ä¸Šã®ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ãªã©ã«ã‚ˆãä½¿ã‚ã‚Œã‚‹
* ã•ã‚‰ã«ãã®ã‚ˆã†ãªå½¢çŠ¶ã‚’è§£æã™ã‚‹ãŸã‚ã®æ•°å€¤è¨ˆç®—ã«ã‚‚ä½¿ã‚ã‚Œã¾ã™
* (ç™ºå±•)ã‚ˆã‚Šä¸€èˆ¬åŒ–ã—ãŸ[NURBS](https://ja.wikipedia.org/wiki/NURBS)ã€[T-spline](https://ja.wikipedia.org/wiki/T-%E3%82%B9%E3%83%97%E3%83%A9%E3%82%A4%E3%83%B3)ã¨ã‹ã‚‚ã‚ã‚Šã¾ã™

# BasicBSpline.jlã®ã§ãã‚‹ã“ã¨
ã‚ˆã†ã‚„ãæœ¬é¡Œã§ã™ã€‚
ä»¥ä¸‹ã¯ã‚ãã¾ã§ä¸€ä¾‹ã§ã™ã€‚

## ğŸ„‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
å…¬å¼ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å…¥ã£ãŸã®ã§ï¼ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å…¥ã‚Šã¾ã™ã€‚
```julia
pkg> add BasicBSpline
```

## â‘ B-splineåŸºåº•é–¢æ•°ã®è¨ˆç®—
Plots.jlã§ãƒ—ãƒ­ãƒƒãƒˆã¾ã§è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†

```julia
using BasicBSpline
using Plots
gr()

k = Knots([0.00,1.50,2.50,5.50,8.00,9.00,9.50,10.0])
P0 = BSplineSpace(0,k) # 0th degree piecewise polynomial space
P1 = BSplineSpace(1,k) # 1st degree piecewise polynomial space
P2 = BSplineSpace(2,k) # 2nd degree piecewise polynomial space
P3 = BSplineSpace(3,k) # 3rd degree piecewise polynomial space
plot(
    plot([t->bsplinebasis(P0,i,t) for i in 1:dim(P0)], 0, 10, ylims=(0,1), legend=false),
    plot([t->bsplinebasis(P1,i,t) for i in 1:dim(P1)], 0, 10, ylims=(0,1), legend=false),
    plot([t->bsplinebasis(P2,i,t) for i in 1:dim(P2)], 0, 10, ylims=(0,1), legend=false),
    plot([t->bsplinebasis(P3,i,t) for i in 1:dim(P3)], 0, 10, ylims=(0,1), legend=false),
    layout=(2,2),
)
```
![](https://storage.googleapis.com/zenn-user-upload/i4ym8xlfw1c79q2vwsjcf5k37eqg)

## â‘¡B-splineæ›²ç·šã®æç”»
æç”»ã«ã¯BasicBSpline.jlã¨ã¯åˆ¥ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸[ExportNURBS.jl](https://github.com/hyrodium/ExportNURBS.jl)ã‚’ä½¿ã„ã¾ã™ã€‚
ã“ã¡ã‚‰ã¯ã¾ã å…¬å¼ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ç™»éŒ²ã—ã¦ãªã„ã®ã§ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ä¸‹ã•ã„ã€‚
```julia
pkg> add https://github.com/hyrodium/ExportNURBS.jl
```

BasicBSpline.jlã§å‡ºåŠ›ã™ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```julia
## 1-dim B-spline manifold
p = 2 # degree of polynomial
k = Knots(1:12) # knot vector
P = FastBSplineSpace(p, k) # B-spline space
a = [[i-5, 3*sin(i^2)] for i in 1:dim(P)] # control points
M = BSplineCurve([P], a) # Define B-spline manifold
save_png("docs/src/img/1dim.png", M, unitlength = 50)
```

![](https://storage.googleapis.com/zenn-user-upload/4mnnv5zmwuzyw1h3zaheqjtaeas6)

## â‘¢B-splineæ›²ç·šã®ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°
ã“ã“ã§ã¯siné–¢æ•°ã‚’ä¾‹ã«ãƒ•ã‚£ãƒƒãƒ†ãƒ³ã‚°ã•ã›ã¦ã¿ã¾ã™ã€‚
BasicBSpline.jlã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦ãƒ•ã‚£ãƒƒãƒ†ãƒ³ã‚°ã—ã¦åˆ¶å¾¡ç‚¹ãŒæ±ºå®šã§ãã¾ã™ã€‚

```julia
p = 3
k = Knots(range(-2Ï€,2Ï€,length=8))+p*Knots(-2Ï€,2Ï€)
P = FastBSplineSpace(p, k)

f(t) = [t,sin(t)]

a = fittingcontrolpoints(f, P)
M = BSplineManifold([P],a)
save_svg("sine_curve.svg", M, unitlength=50, up=2, down=-2, left=-8, right=8)
```

![](https://github.com/hyrodium/BasicBSpline.jl/raw/master/docs/src/img/sine_curve.svg)


ã“ã“ã§ã®ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã®è¨ˆç®—ã«ã¯æœ€å°äºŒä¹—æ³•ã‚’ä½¿ã£ã¦ä»¥ä¸‹ã®å€¤ã‚’æœ€å°åŒ–ã™ã‚‹ã‚ˆã†ãªåˆ¶å¾¡ç‚¹ã®ä½ç½®$\bm{a}_i$ã‚’æ±ºå®šã—ã¦ã„ã¾ã™ã€‚

$$
\begin{aligned}
&\int_{I}\left\|\bm{f}(t) - \sum_i {B_{(i,p,k)}(t) \bm{a}_i}\right\|^2 dt & \bigl(I = [k_{1+p},k_{l-p}], k &= (k_1,\dots,k_l)\bigr)
\end{aligned}
$$

ãƒãƒƒãƒˆåˆ—ã®ä½ç½®ã‚’å¤‰æ›´ã—ã¦ã€siné–¢æ•°ã‚’è¿‘ä¼¼ã™ã‚‹åŒºé–“ã‚’å¤‰æ›´ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

![](https://64.media.tumblr.com/8798c39a350ac222ccc7f74868f0591a/ce416438a0e37413-88/s1280x1920/dad464725ef5ac7f074bb88dffb6133f931cc2e7.gifv)

ã“ã®å‹•ç”»ã‚’ç”Ÿæˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¯ã¯ä»¥ä¸‹ã®gistã«ã‚ã‚Šã¾ã™ã€‚
https://gist.github.com/hyrodium/9c0130f660ab5430746319ab498a0fe9

## â‘£B-splineæ›²é¢ã®æç”»
ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§å®Ÿè¡Œã§ãã¾ã™ã€‚

```julia
using BasicBSpline
using ExportNURBS

p = 2 # degree of polynomial
k = Knots(1:8) # knot vector
P = BSplineSpace(p,k) # B-spline space
rand_a = [rand(2) for i in 1:dim(P), j in 1:dim(P)]
a = [[2*i-6.5,2*j-6.5] for i in 1:dim(P), j in 1:dim(P)] + rand_a # random generated control points
M = BSplineManifold([P,P],a) # Define B-spline manifold
save_png("2dim.png", M) # save image
```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯

1. å¤šé …å¼æ¬¡æ•°ã®å®šç¾© (`p`)
2. ãƒãƒƒãƒˆåˆ—ã®å®šç¾© (`k`)
3. åŒºåˆ†å¤šé …å¼ç©ºé–“ã®å®šç¾© (`P`)
4. B-splineæ›²é¢ã®å®šç¾© (`BSplineManifold`)
5. pngå‡ºåŠ› (`save_png`)

ã§ã™ã€‚
å‡ºåŠ›çµæœ(png)ã¯ã“ã¡ã‚‰â†“

![](https://storage.googleapis.com/zenn-user-upload/0ekv32rxmw6sx9nn1p38qc4red9l)

## â‘¤B-splineæ›²é¢ã®ãƒ•ã‚£ãƒƒãƒ†ãƒ³ã‚°
ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§å®Ÿè¡Œã§ãã¾ã™ã€‚

```julia
p1 = 2
p2 = 2
k1 = Knots(-10:10)+p1*Knots(-10,10)
k2 = Knots(-10:10)+p2*Knots(-10,10)
P1 = FastBSplineSpace(p1, k1)
P2 = FastBSplineSpace(p2, k2)

f(u1, u2) = [2u1 + sin(u1) + cos(u2) + u2 / 2, 3u2 + sin(u2) + sin(u1) / 2 + u1^2 / 6] / 5

a = fittingcontrolpoints(f, P1, P2)
M = BSplineManifold([P1,P2],a)
save_png("fitting.png", M, unitlength=50, up=10, down=-10, left=-10, right=10)
```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯

1. å¤šé …å¼æ¬¡æ•°ã®å®šç¾© (`p1`, `p2`)
2. ãƒãƒƒãƒˆåˆ—ã®å®šç¾© (`k1`, `k2`)
3. åŒºåˆ†å¤šé …å¼ç©ºé–“ã®å®šç¾© (`P1`, `P2`)
4. ãƒ•ã‚£ãƒƒãƒ†ãƒ³ã‚°å¯¾è±¡ã®é–¢æ•°ã®å®šç¾© (`f`)
5. ãƒ•ã‚£ãƒƒãƒ†ãƒ³ã‚°ã®è¨ˆç®— (`fittingcontolpoints`)
6. B-splineæ›²é¢ã®å®šç¾© (`BSplineManifold`)
7. pngå‡ºåŠ› (`save_png`)

ã§ã™ã€‚
å‡ºåŠ›çµæœ(png)ã¯ã“ã¡ã‚‰â†“

![](https://storage.googleapis.com/zenn-user-upload/c47juuferc17kwxqf5i9bbbev0yc)

Desmosã§ã®ç¢ºèªã¯ã“ã¡ã‚‰â†“

https://www.desmos.com/calculator/2hm3b1fbdf


## â‘¥B-splineå¤šæ§˜ä½“ã®ç´°åˆ†
ã€Œå½¢çŠ¶ã‚’ä¿ã£ãŸã¾ã¾ã€æ¬¡æ•°ã‚„ãƒãƒƒãƒˆã®æ•°ã‚’å¢—ã‚„ã™æ“ä½œã€ã®ã“ã¨ã‚’ç´°åˆ†(refinement)ã¨å‘¼ã³ã¾ã™ã€‚
ç†è«–ã¯ã¨ã‚‚ã‹ãã¨ã—ã¦ã€BasicBSpline.jlã§è¨ˆç®—ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```julia
using BasicBSpline
using ExportNURBS

p = 2 # degree of polynomial
k = Knots(1:8) # knot vector
P = BSplineSpace(p,k) # B-spline space
rand_a = [rand(2) for i in 1:dim(P), j in 1:dim(P)]
a = [[2*i-6.5,2*j-6.5] for i in 1:dim(P), j in 1:dim(P)] + rand_a # random generated control points
M = BSplineManifold([P,P],a) # Define B-spline manifold
save_png("2dim.png", M) # save image
```

![](https://storage.googleapis.com/zenn-user-upload/0ekv32rxmw6sx9nn1p38qc4red9l)

ã“ã‚Œã¯ä¸Šã®ã€Œâ‘£B-splineæ›²é¢ã®æç”»ã€ã§ã®ä¾‹ã¨åŒã˜ã§ã™ã€‚
ã“ã‚Œã®ç´°åˆ†ã‚’è¨ˆç®—ã—ã¾ã—ã‚‡ã†ã€‚

```julia
kâ‚Š=[Knots(3.3,4.2),Knots(3.8,3.2,5.3)] # additional knots
Mâ€² = refinement(M,kâ‚Š=kâ‚Š) # refinement of B-spline manifold
save_png("2dim_refinement.png", Mâ€²) # save image
```

![](https://storage.googleapis.com/zenn-user-upload/0pn7pctd7yscfq6tcwz2h5q2jops)

ã“ã‚Œã‚‰2ã¤ã®ç”»åƒã§ã®ã€Œèµ¤è‰²ã®å½¢çŠ¶ã€ã¯å…¨ãåŒã˜ã§ã™ãŒã€åˆ¶å¾¡ç‚¹ã®æ•°ã¯ç´°åˆ†å¾Œã«å¢—ãˆã¦ã„ã¾ã™ã€‚
ã“ã“ã®ä¾‹ã®ã‚ˆã†ãªã€ãƒãƒƒãƒˆåˆ—ã®æŒ¿å…¥ã«ã‚ˆã‚‹ç´°åˆ†ã¯**h-ç´°åˆ†**ã¨å‘¼ã°ã‚Œã¾ã™ã€‚(ãƒãƒƒãƒˆåˆ—ã®é–“éš”ã‚’è¡¨ã™è¨˜å·ã«$h$ãŒä½¿ã‚ã‚Œã‚‹ãŸã‚ã®ã‚ˆã†ã§ã™ã€‚)
ä¸€æ–¹ã§ã€æ¬¡æ•°ã‚’å¢—ã‚„ã™ç´°åˆ†ã®æ“ä½œã¯**p-ç´°åˆ†**ã¨å‘¼ã°ã‚Œã¾ã™ã€‚(ã“ã¡ã‚‰ã®ä¾‹ã‚‚å…¥ã‚ŒãŸã‹ã£ãŸã®ã§ã™ãŒã€[ãƒã‚°](https://github.com/hyrodium/BasicBSpline.jl/issues/57)ãŒå…¥ã£ã¦ã¦å¾®å¦™ã«é–“ã«åˆã‚ãš..ã‚ã¨ã§ä¿®æ­£ã—ã¾ã™)

ã“ã®ã‚ˆã†ã«åˆ¶å¾¡ç‚¹ã‚’å¢—ã‚„ã™ã“ã¨ã¯ã„ãã¤ã‹ã®åˆ©ç‚¹ãŒã‚ã‚Šã¾ã™:

* åˆ¶å¾¡ç‚¹ã®ç´°ã‹ã„èª¿æ•´ã§ã‚ˆã‚Šç²¾åº¦ã®é«˜ã„ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ãŒã§ãã‚‹
* B-splineå¤šæ§˜ä½“ä¸Šã®æ•°å€¤è¨ˆç®—ã®ç²¾åº¦ãŒå‘ä¸Šã§ãã‚‹

# ä»Šå¾Œã®æ–¹é‡
* B-splineé–¢é€£ã®å®Ÿè£…ã¯ä¸€é€šã‚Šçµ‚ã‚ã£ãŸæ°—ãŒã—ã¾ã™ãŒ..ä»¥ä¸‹ã®ã‚ˆã†ãªå¤‰æ›´äºˆå®šãŒã‚ã‚Šã¾ã™
  * `Knots`å‹ã‚’ãƒ‘ãƒ©ãƒ¡ãƒˆãƒªãƒƒã‚¯å‹ã«å¤‰æ›´ã—ã¦`Float64`ä»¥å¤–ã‚‚å¯¾å¿œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
  * ç­‰é–“éš”ã®ãƒãƒƒãƒˆåˆ—ã®ãŸã‚ã®å‹ã‚’ç”¨æ„ã—ã¦ã€ä¸€éƒ¨ã®è¨ˆç®—ã‚’é«˜é€ŸåŒ–ã•ã›ã‚‹
* [NURBS](https://ja.wikipedia.org/wiki/NURBS)ã€[T-spline](https://ja.wikipedia.org/wiki/T-%E3%82%B9%E3%83%97%E3%83%A9%E3%82%A4%E3%83%B3)ã¸ã®ä¸€èˆ¬åŒ–
  * T-splineã¯ã¾ã ç§ãŒå®Œå…¨ã«ã¯ç†è§£ã§ãã¦ãªã„ã§ã™ã€‚ä»Šå¾Œã®èª²é¡Œ
  * ãã‚‚ãã‚‚T-splineã¯ç‰¹è¨±é–¢é€£ãŒã‚ã‚‹ã®ã§ã‚„ã‚„ã“ã—ãã†ã€‚
  * 2003å¹´ã«ç‰¹è¨±ç”³è«‹ã•ã‚ŒãŸã‚‰ã—ã„ã®ã§ãã‚ãã‚åˆ‡ã‚Œãã†â€¦ï¼Ÿ
  * å®Ÿè£…ã™ã‚‹ã«ã—ã¦ã‚‚åˆ¥ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ãªã‚‹äºˆå®š
* å½¢çŠ¶å‡ºåŠ›ç”¨ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸(ExportNURBS.jl)ã®å……å®ŸåŒ–
  * NURBSã«å¯¾å¿œã—ã¦ã‹ã‚‰å……å®Ÿã•ã›ã‚‹ã¤ã‚‚ã‚Šã§å‘½åã—ã¦ã„ã¾ã—ãŸ
  * ã—ã‹ã—ã€BasicBSpline.jlç”¨ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ†ã‘ãŸæ–¹ãŒè‰¯ã•ãã†
  * ç¾åœ¨ã¯PNG, SVGå‡ºåŠ›ã®ã¿ã«å¯¾å¿œã—ã¦ã„ã¾ã™ãŒã€å°†æ¥çš„ã«ã¯POV-Ray, Blender, STL, Paraviewå‘ã‘ã®å‡ºåŠ›ãªã©ã«ã‚‚å¯¾å¿œã—ãŸã„
* æ•°å€¤è¨ˆç®—ã®å…·ä½“ä¾‹ã‚’æ›¸ã
  * [æ•°å€¤è¨ˆç®—AdventCalendar2018](https://qiita.com/advent-calendar/2018/numerical_analysis)ã«æ›¸ã„ãŸ[è¨˜äº‹](https://hackmd.io/@hyrodium/ryXDNCjJ4?type=view)ã‚’æ›¸ãç›´ã—ãŸã„â€¦ã€‚


# ã‚‚ã£ã¨å­¦ã³ãŸã„äººã¸
* BasicBSpline.jlã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
    * https://hyrodium.github.io/BasicBSpline.jl/dev/
    * Mathematical properties of B-splineã®ç¯€ã¨ã‹ã©ã†ã‹ãª
* Geometric Modeling with Splines
    * https://www.routledge.com/p/book/9780367447243
    * è‹±èªã§ã™ãŒæ•°å­¦çš„ã«å³å¯†ã«æ›¸ã‹ã‚Œã¦ã¦åˆ†ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚
    * æ—¥æœ¬èªã®è‰¯ã„æ›¸ç±ã£ã¦ç„¡ã„ã‚“ã§ã™ã‹ï¼Ÿ â†’ çŸ¥ã‚‰ãªã„ã§ã™
* NURBSã«ã‚ˆã‚‹å½¢çŠ¶è¡¨ç¾
    * https://hyrodium.github.io/pdf/
    * ç§ã®æ›¸ã„ãŸè³‡æ–™ã§ã™ã€‚(å…¨40ãƒšãƒ¼ã‚¸)
    * ãƒã‚¸ã§èª­ã‚“ã§ãã ã•ã„ï¼
    * **ãƒã‚¸ã§èª­ã‚“ã§ãã ã•ã„ï¼ï¼**
